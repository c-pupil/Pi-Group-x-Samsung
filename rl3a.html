<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RL-3A: Next-Gen Camera Control</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-dark: #000000;
            --bg-light: #f5f5f7;
            --card-light: #ffffff;
            --text-primary-dark: #f5f5f7;
            --text-secondary-dark: #86868b;
            --text-primary-light: #1d1d1f;
            
            /* RL-3A Theme: Dynamic Amber */
            --accent-color: #FF9F0A; 
            --accent-glow: rgba(255, 159, 10, 0.25);
            --radius-xl: 24px;
            --glass-panel: rgba(28, 28, 30, 0.65);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary-dark);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Navbar */
        .navbar {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: saturate(180%) blur(20px);
            position: fixed; top: 0; width: 100%; z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding: 0.8rem 0;
        }
        .navbar-brand { font-weight: 600; font-size: 1.1rem; color: #fff !important; }
        .nav-link { font-size: 0.85rem; color: rgba(255,255,255,0.8) !important; margin-left: 24px; transition: color 0.2s; }
        .nav-link:hover { color: #fff !important; }

        /* Hero Section */
        .hero-section {
            position: relative; height: 100vh; width: 100%;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        .hero-bg_2 { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            object-fit: cover; z-index: -1; filter: brightness(0.5) blur(5px); transform: scale(1.05);
        }
        .hero-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(0,0,0,0.1) 0%, #000 100%);
            z-index: 1;
        }
        .hero-content { position: relative; z-index: 10; text-align: center; max-width: 1000px; padding: 0 20px; }
        
        .hero-title {
            font-size: 6rem; font-weight: 700; letter-spacing: -0.04em; line-height: 1;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #fff 0%, #ffd60a 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: fadeUp 1s ease forwards;
        }
        .hero-subtitle {
            font-size: 1.8rem; color: #a1a1a6; font-weight: 400; margin-bottom: 2rem;
            animation: fadeUp 1s ease 0.2s forwards; opacity: 0; transform: translateY(20px);
        }

        .collab-badge {
            display: inline-flex; align-items: center; gap: 15px;
            padding: 10px 24px; border-radius: 100px;
            background: rgba(20, 20, 20, 0.6); border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(20px); margin-bottom: 3rem;
            animation: fadeUp 1s ease 0.3s forwards; opacity: 0; transform: translateY(20px);
        }
        .collab-text { font-size: 0.95rem; font-weight: 500; color: #ccc; }
        .collab-highlight { color: #fff; font-weight: 600; }
        .samsung-tag {
            background: #1428a0; color: #fff; padding: 4px 12px; border-radius: 6px;
            font-size: 0.8rem; font-weight: 700; letter-spacing: 0.05em;
        }

        .btn-action {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 14px 32px; border-radius: 100px;
            background: #fff; color: #000; font-size: 1rem; font-weight: 600;
            text-decoration: none; transition: transform 0.2s; margin: 0 10px;
        }
        .btn-action:hover { transform: scale(1.05); }
        .btn-action.outline { 
            background: rgba(255,255,255,0.1); color: #fff; 
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); 
        }

        /* Abstract */
        .abstract-section { padding: 8rem 0; background: var(--bg-light); color: var(--text-primary-light); }
        .abstract-container {
            max-width: 900px; margin: 0 auto; padding: 4rem;
            background: var(--card-light); border-radius: var(--radius-xl);
            box-shadow: 0 20px 40px rgba(0,0,0,0.04);
            text-align: justify; font-size: 1.2rem; line-height: 1.8; color: #424245;
        }

        /* --- Live Engine Demo --- */
        .demo-section {
            padding: 6rem 0 8rem; background: #000; position: relative; border-top: 1px solid #333;
            overflow: hidden;
        }
        .demo-glow {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 800px; height: 500px;
            background: radial-gradient(circle, rgba(255,159,10,0.1) 0%, rgba(0,0,0,0) 70%);
            filter: blur(100px); pointer-events: none; z-index: 0;
        }
        .demo-header { text-align: center; margin-bottom: 3rem; position: relative; z-index: 2; }
        .demo-header h2 { font-size: 3.5rem; font-weight: 700; color: #fff; margin-bottom: 0.8rem; }
        .demo-header p { color: #86868b; font-size: 1.2rem; }

        /* Scene Selector */
        .scene-tabs {
            display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; position: relative; z-index: 5;
        }
        .scene-btn {
            padding: 10px 24px; border-radius: 100px; border: 1px solid rgba(255,255,255,0.2);
            color: #86868b; background: rgba(0,0,0,0.5); cursor: pointer; transition: all 0.3s;
            font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; gap: 8px;
        }
        .scene-btn:hover { color: #fff; border-color: rgba(255,255,255,0.5); }
        .scene-btn.active {
            background: var(--accent-color); color: #000; border-color: var(--accent-color);
            font-weight: 700; box-shadow: 0 0 20px rgba(255,159,10,0.4);
        }

        .device-container {
            width: 100%; max-width: 1100px; margin: 0 auto;
            position: relative; z-index: 2;
            display: flex; gap: 40px; align-items: stretch;
        }
        
        /* Viewfinder */
        .viewfinder-wrapper {
            flex: 1.6; position: relative;
            aspect-ratio: 16/9; border-radius: 20px; overflow: hidden;
            box-shadow: 0 0 0 10px #1a1a1a, 0 40px 80px rgba(0,0,0,0.6);
            background: #000;
        }
        
        .vf-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; transition: transform 2s ease;
        }
        .vf-before { z-index: 1; }
        .vf-after { z-index: 2; opacity: 0; transition: opacity 1.5s ease-in-out; }
        
        .scan-line {
            position: absolute; top: -10%; left: 0; width: 100%; height: 20%;
            background: linear-gradient(to bottom, transparent, rgba(255, 159, 10, 0.4), transparent);
            z-index: 3; pointer-events: none; opacity: 0;
        }
        .scan-anim { animation: scanDown 1.5s cubic-bezier(0.45, 0, 0.55, 1) infinite; opacity: 1; }
        @keyframes scanDown { 0% { top: -20%; } 100% { top: 120%; } }

        .hud-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .focus-box {
            position: absolute; width: 100px; height: 100px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            transition: all 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28); opacity: 0.6;
        }
        .focus-box::after { content: 'AF Locked'; position: absolute; top: -25px; left: 0; color: var(--accent-color); font-size: 0.8rem; font-weight: 700; opacity: 0; transition: opacity 0.3s; }
        .focus-box.searching { border-color: #fff; animation: pulseBox 0.5s infinite; }
        .focus-box.locked { border-color: var(--accent-color); opacity: 1; box-shadow: 0 0 15px var(--accent-color); }
        .focus-box.locked::after { opacity: 1; }

        @keyframes pulseBox { 0% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.1); } 100% { transform: translate(-50%, -50%) scale(1); } }

        /* Dashboard */
        .params-panel { flex: 1; display: grid; grid-template-columns: 1fr; gap: 15px; align-content: center; }
        
        .param-card {
            background: rgba(28, 28, 30, 0.8); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 14px;
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
        }
        .param-label { font-size: 0.8rem; color: #86868b; font-weight: 600; text-transform: uppercase; display: flex; align-items: center; gap: 8px; }
        .param-label i { color: var(--accent-color); width: 20px; text-align: center; }
        .param-value { font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; color: #fff; font-weight: 700; width: 90px; text-align: right; }
        .param-bar-bg { width: 100%; height: 4px; background: rgba(255,255,255,0.1); margin-top: 8px; border-radius: 2px; }
        .param-bar-fill { height: 100%; background: var(--accent-color); width: 0%; border-radius: 2px; transition: width 0.1s linear; }

        .demo-controls { margin-top: 40px; text-align: center; position: relative; z-index: 2; }
        .status-pill {
            display: inline-block; margin-bottom: 20px;
            padding: 6px 16px; border-radius: 100px; font-size: 0.85rem; font-weight: 600;
            background: rgba(255,255,255,0.1); color: #86868b; transition: all 0.3s;
        }
        .status-pill.active { background: rgba(255, 159, 10, 0.2); color: var(--accent-color); }

        @media(max-width: 991px) {
            .device-container { flex-direction: column; }
            .viewfinder-wrapper { width: 100%; }
            .params-panel { width: 100%; grid-template-columns: 1fr 1fr; }
        }

        /* --- Architecture (Tabs) --- */
        .arch-section { padding: 6rem 0; background: #0b0b0b; border-top: 1px solid #222; }
        .tabs-nav { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; }
        .tab-btn {
            padding: 10px 24px; border-radius: 100px;
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1);
            color: #86868b; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: all 0.2s;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.15); color: #fff; }
        .tab-btn.active { background: var(--accent-color); color: #000; font-weight: 600; }
        .arch-display {
            max-width: 1100px; margin: 0 auto;
            background: #111; border: 1px solid #333; border-radius: 20px; padding: 20px;
        }
        .arch-img { width: 100%; height: auto; border-radius: 12px; }
        .arch-caption { margin-top: 20px; color: #ccc; text-align: center; font-size: 1rem; }

        /* --- Features (Bento) --- */
        .features-section { padding: 6rem 0; background: var(--bg-light); border-top: 1px solid #e5e5e5; }
        .bento-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; max-width: 1100px; margin: 0 auto; }
        .bento-card { background: #fff; padding: 40px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); }
        .icon-box { width: 50px; height: 50px; border-radius: 12px; background: rgba(255,159,10,0.1); color: var(--accent-color); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 20px; }
        .bento-title { font-size: 1.4rem; font-weight: 700; margin-bottom: 10px; color: #1d1d1f; }
        .bento-desc { color: #666; line-height: 1.5; }

        footer { background: #000; padding: 5rem 0; text-align: center; color: #666; border-top: 1px solid #222; }
        
        @keyframes fadeUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="index.html"><i class="fas fa-chevron-left me-2"></i>PI Group</a>
            <div class="collapse navbar-collapse justify-content-end">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="#abstract">Abstract</a></li>
                    <li class="nav-item"><a class="nav-link" href="#demo" style="color: #fff !important;">Live Engine</a></li>
                    <li class="nav-item"><a class="nav-link" href="#system">Architecture</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="hero-section">
        <img src="https://images.unsplash.com/photo-1516035069371-29a1b244cc32?q=80&w=2564&auto=format&fit=crop" class="hero-bg_2" alt="Lens Background">
        <div class="hero-overlay"></div>
        
        <div class="hero-content">
            <div class="collab-badge">
                <span class="collab-text"><span class="collab-highlight">Joint Research Project</span> with</span>
                <span class="samsung-tag">SAMSUNG Research</span>
            </div>

            <h1 class="hero-title">RL-3A</h1>
            <p class="hero-subtitle">Mastering Dynamic Scenes with RL-Driven Computational 3A</p>
            
            <div style="opacity: 0; animation: fadeUp 1s ease 0.6s forwards; transform: translateY(20px);">
                <a href="#abstract" class="btn-action">Read Abstract</a>
                <a href="#demo" class="btn-action outline">Experience Demo</a>
            </div>
        </div>
    </section>

    <section id="abstract" class="abstract-section">
        <div class="container">
            <div class="abstract-container">
                <h3 style="text-align:center; font-weight:700; margin-bottom:1.5rem; color:#1d1d1f;">Project Abstract</h3>
                <p>
                    Traditional camera control systems (3A: Auto-Exposure, Auto-Focus, Auto-White Balance) heavily rely on statistical analysis, which often fails in high-dynamic-range or fast-motion scenes.
                    <br><br>
                    <strong>RL-3A</strong> introduces a revolutionary paradigm shift: utilizing <strong>Reinforcement Learning (RL)</strong> to implement 3A in preview mode based on deep semantic scene understanding. By actively tuning physical lens and sensor parameters (ISO, shutter, aperture, focus distance) alongside ISP color gains, our system moves beyond statistics to true perception.
                </p>
            </div>
        </div>
    </section>

    <section id="demo" class="demo-section">
        <div class="demo-glow"></div>
        <div class="container">
            <div class="demo-header">
                <h2>Intelligent 3A Engine</h2>
                <p>Real-time Parameter Optimization Visualization</p>
            </div>

            <div class="scene-tabs">
                <div class="scene-btn active" onclick="selectScene(1)"><i class="fas fa-sun"></i> High Dynamic Range</div>
                <div class="scene-btn" onclick="selectScene(2)"><i class="fas fa-running"></i> High Motion</div>
                <div class="scene-btn" onclick="selectScene(3)"><i class="fas fa-palette"></i> Auto White Balance</div>
            </div>

            <div class="device-container">
                <div class="viewfinder-wrapper">
                    <img id="vfBefore" src="./data/rl3a/demo_before_1.png" class="vf-layer vf-before" alt="Raw Input">
                    <img id="vfAfter" src="./data/rl3a/demo_after_1.png" class="vf-layer vf-after" alt="RL Result">
                    <div class="scan-line" id="scanLine"></div>
                    <div class="hud-overlay">
                        <div class="focus-box" id="focusBox"></div>
                    </div>
                </div>

                <div class="params-panel">
                    <div class="param-card">
                        <div>
                            <div class="param-label"><i class="fas fa-bullseye"></i> ISO</div>
                            <div class="param-bar-bg"><div id="barISO" class="param-bar-fill"></div></div>
                        </div>
                        <div class="param-value" id="valISO">--</div>
                    </div>
                    <div class="param-card">
                        <div>
                            <div class="param-label"><i class="fas fa-camera"></i> Aperture</div>
                            <div class="param-bar-bg"><div id="barAperture" class="param-bar-fill"></div></div>
                        </div>
                        <div class="param-value" id="valAperture">--</div>
                    </div>
                    <div class="param-card">
                        <div>
                            <div class="param-label"><i class="fas fa-clock"></i> Shutter</div>
                            <div class="param-bar-bg"><div id="barShutter" class="param-bar-fill"></div></div>
                        </div>
                        <div class="param-value" id="valShutter">--</div>
                    </div>
                    <div class="param-card">
                        <div>
                            <div class="param-label"><i class="fas fa-ruler-horizontal"></i> Focus</div>
                            <div class="param-bar-bg"><div id="barFocus" class="param-bar-fill"></div></div>
                        </div>
                        <div class="param-value" id="valFocus">--</div>
                    </div>
                    <div class="param-card">
                        <div>
                            <div class="param-label"><i class="fas fa-temperature-high"></i> WB Temp</div>
                            <div class="param-bar-bg"><div id="barWB" class="param-bar-fill"></div></div>
                        </div>
                        <div class="param-value" id="valWB">--</div>
                    </div>
                </div>
            </div>

            <div class="demo-controls">
                <div id="statusPill" class="status-pill">System Standby</div><br>
                <button class="btn-action" id="btnDemo" onclick="runDemo()">Activate RL Agent</button>
            </div>
        </div>
    </section>

    <section id="system" class="arch-section">
        <div class="arch-glow"></div>
        
        <div class="container">
            <div class="section-header">
                <h2>System Architecture</h2>
                <p>Hardware-in-the-Loop Optimization Pipeline</p>
            </div>

            <div class="arch-container">
                <div class="tabs-nav">
                    <div class="tab-btn active" onclick="loadTab('intro')">Challenge & Motivation</div>
                    <div class="tab-btn" onclick="loadTab('overview')">System Overview</div>
                    <div class="tab-btn" onclick="loadTab('synthesis')">Data Synthesis</div>
                    <div class="tab-btn" onclick="loadTab('inference')">Inference Pipeline</div>
                </div>

                <div class="arch-display">
                    <img id="archImg" src="" class="arch-img" alt="System Diagram">
                    <p id="archDesc" class="arch-caption">Loading...</p>
                </div>
            </div>
        </div>
    </section>

    <section id="features" class="features-section">
        <div class="container">
            <div class="section-header" style="margin-bottom: 3rem;">
                <h2 style="color: #1d1d1f;">Key Innovations</h2>
            </div>

            <div class="bento-grid">
                <div class="bento-card">
                    <div class="icon-box"><i class="fas fa-brain"></i></div>
                    <h3 class="bento-title">Reinforcement Learning</h3>
                    <p class="bento-desc">Utilizes RL to achieve real-time adjustments and instant feedback during the preview phase, optimizing beyond static rules.</p>
                </div>
                
                <div class="bento-card">
                    <div class="icon-box"><i class="fas fa-microchip"></i></div>
                    <h3 class="bento-title">Hardware-in-the-Loop</h3>
                    <p class="bento-desc">A modular HIL design that allows for easy replacement of ISP modules, supporting devices from different manufacturers.</p>
                </div>

                <div class="bento-card">
                    <div class="icon-box"><i class="fas fa-eye"></i></div>
                    <h3 class="bento-title">Semantic Perception</h3>
                    <p class="bento-desc">Moves beyond traditional statistical analysis to semantic scene perception, enabling precise handling of object motion.</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div style="margin-bottom: 20px; font-weight: 600; color: #fff;">PI Group x Samsung Research</div>
            <div style="font-size: 0.9rem;">
                &copy; 2026 PI Group. Designed with Apple Aesthetics.
                <br>
                <span style="opacity: 0.5; font-size: 0.8rem;">Website Template provided by Yuanlin Zhang.</span>
            </div>
        </div>
    </footer>

    <script>
        // --- Tabs ---
        const tabData = {
            intro: { src: "./data/rl3a/intro.png", text: "Conventional 3A systems rely on simple statistics, leading to failures in high-dynamic-range or fast-motion scenes." },
            overview: { src: "./data/rl3a/overview.png", text: "The system operates as a closed loop where an RL agent (Actor-Critic) predicts physical control parameters based on a perturbed RAW state." },
            synthesis: { src: "./data/rl3a/synthesis.png", text: "We develop a 3A Parameter-Aware Data Synthesis Pipeline that models the physical coupling of motion blur, sensor noise, and defocus blur." },
            inference: { src: "./data/rl3a/inference.png", text: "In the inference stage, the semantic-aware RL agent analyzes the initial capture to predict optimal control parameters." }
        };

        function loadTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            // Mapping index manually for simplicity
            const map = {intro:0, overview:1, synthesis:2, inference:3};
            document.querySelectorAll('.tab-btn')[map[tabId]].classList.add('active');

            const img = document.getElementById('archImg');
            const desc = document.getElementById('archDesc');
            img.style.opacity = 0; desc.style.opacity = 0;

            setTimeout(() => {
                img.src = tabData[tabId].src;
                desc.innerText = tabData[tabId].text;
                img.style.opacity = 1; desc.style.opacity = 1;
            }, 300);
        }

        // --- Live Demo Logic ---
        let currentScene = 1;
        let demoInterval;
        const scanLine = document.getElementById('scanLine');
        const focusBox = document.getElementById('focusBox');
        const status = document.getElementById('statusPill');
        
        // Scene Optimization Targets
        const targets = {
            1: { iso: 200, aperture: 'f/2.8', shutter: '1/500', focus: '1.2m', wb: '5600K' }, // HDR
            2: { iso: 800, aperture: 'f/4.0', shutter: '1/1000', focus: '3.5m', wb: '5200K' }, // Motion
            3: { iso: 400, aperture: 'f/1.8', shutter: '1/100', focus: '0.8m', wb: '3200K' }  // WB
        };

        function selectScene(id) {
            currentScene = id;
            document.querySelectorAll('.scene-btn').forEach((btn, idx) => {
                btn.classList.toggle('active', idx === id - 1);
            });
            
            // Reset Demo State
            clearInterval(demoInterval);
            document.getElementById('vfBefore').src = `./data/rl3a/demo_before_${id}.png`;
            document.getElementById('vfAfter').src = `./data/rl3a/demo_after_${id}.png`;
            document.getElementById('vfAfter').style.opacity = 0;
            
            scanLine.classList.remove('scan-anim');
            focusBox.classList.remove('locked');
            focusBox.classList.remove('searching');
            document.getElementById('btnDemo').disabled = false;
            document.getElementById('btnDemo').innerText = "Activate RL Agent";
            status.innerText = "System Standby";
            status.classList.remove('active');
            
            // Reset params display
            resetParams();
        }

        function resetParams() {
            updateParam('valISO', 'barISO', 0, 3200);
            updateParam('valAperture', 'barAperture', 0, 22);
            updateParam('valShutter', 'barShutter', 0, 1000);
            updateParam('valFocus', 'barFocus', 0, 10);
            updateParam('valWB', 'barWB', 0, 8000);
            
            document.getElementById('valISO').innerText = '--';
            document.getElementById('valAperture').innerText = '--';
            document.getElementById('valShutter').innerText = '--';
            document.getElementById('valFocus').innerText = '--';
            document.getElementById('valWB').innerText = '--';
        }

        function runDemo() {
            const btn = document.getElementById('btnDemo');
            btn.disabled = true;
            btn.innerText = "Optimizing...";
            status.innerText = "Semantic Analysis & RL Exploration...";
            status.classList.add('active');
            
            scanLine.classList.add('scan-anim');
            focusBox.classList.add('searching');
            
            let steps = 0;
            const maxSteps = 25; 

            demoInterval = setInterval(() => {
                steps++;
                
                // Random Exploration
                updateParam('valISO', 'barISO', Math.floor(Math.random() * 3000)+100, 3200);
                updateParam('valAperture', 'barAperture', 'f/' + (1.4 + Math.random()*10).toFixed(1), 22, true);
                updateParam('valShutter', 'barShutter', '1/' + Math.floor(10 + Math.random()*990), 1000, true);
                updateParam('valFocus', 'barFocus', (Math.random()*5).toFixed(1)+'m', 10, true);
                updateParam('valWB', 'barWB', Math.floor(3000 + Math.random()*4000)+'K', 8000, true);

                // Focus Box Random Move
                focusBox.style.top = (30 + Math.random()*40) + '%';
                focusBox.style.left = (30 + Math.random()*40) + '%';

                if (steps > 15) {
                    const f = (steps - 15) / 10;
                    document.getElementById('vfAfter').style.opacity = f;
                }

                if (steps >= maxSteps) {
                    clearInterval(demoInterval);
                    finalizeDemo(btn);
                }
            }, 100);
        }

        function finalizeDemo(btn) {
            const t = targets[currentScene];
            
            updateParam('valISO', 'barISO', t.iso, 3200);
            updateParam('valAperture', 'barAperture', t.aperture, 22, true);
            updateParam('valShutter', 'barShutter', t.shutter, 1000, true);
            updateParam('valFocus', 'barFocus', t.focus, 10, true);
            updateParam('valWB', 'barWB', t.wb, 8000, true);

            focusBox.style.top = '50%'; focusBox.style.left = '50%';
            focusBox.classList.remove('searching');
            focusBox.classList.add('locked');
            scanLine.classList.remove('scan-anim');
            
            document.getElementById('vfAfter').style.opacity = 1;
            status.innerText = "Optimal State Converged";
            btn.innerText = "Re-Run Demo";
            btn.disabled = false;
        }

        function updateParam(valId, barId, value, max, isString=false) {
            document.getElementById(valId).innerText = value;
            let num = value;
            if (isString) {
                // Heuristic mapping for string values like 'f/2.8', '1/500' to progress bar %
                if(value.includes('f/')) num = parseFloat(value.substring(2));
                else if(value.includes('1/')) num = parseInt(value.split('/')[1]);
                else num = parseFloat(value);
            }
            let pct = Math.min((num / max) * 100, 100);
            if (valId === 'valAperture') pct = (1 - (num/22)) * 100; // Inverse logic for aperture size visualization
            document.getElementById(barId).style.width = Math.max(pct, 5) + '%';
        }

        window.onload = () => {
            loadTab('intro');
            selectScene(1);
        };
    </script>
</body>
</html>
